const x={},R=Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"})),{env:g={},argv:y=[],platform:T=""}=typeof process>"u"?{}:process,k="NO_COLOR"in g||y.includes("--no-color"),v="FORCE_COLOR"in g||y.includes("--color"),O=T==="win32",E=g.TERM==="dumb",_=R&&void 0,M="CI"in g&&("GITHUB_ACTIONS"in g||"GITLAB_CI"in g||"CIRCLECI"in g),L=!k&&(v||O&&!E||_||M),f=(e,i,r,n,o=i.substring(0,e)+n,s=i.substring(e+r.length),c=s.indexOf(r))=>o+(c<0?s:f(c,s,r,n)),S=(e,i,r,n,o)=>e<0?r+i+n:r+f(e,i,n,o)+n,$=(e,i,r=e,n=e.length+1)=>o=>o||!(o===""||o===void 0)?S((""+o).indexOf(i,n),o,e,i,r):"",t=(e,i,r)=>$(`\x1B[${e}m`,`\x1B[${i}m`,r),m={reset:t(0,0),bold:t(1,22,"\x1B[22m\x1B[1m"),dim:t(2,22,"\x1B[22m\x1B[2m"),italic:t(3,23),underline:t(4,24),inverse:t(7,27),hidden:t(8,28),strikethrough:t(9,29),black:t(30,39),red:t(31,39),green:t(32,39),yellow:t(33,39),blue:t(34,39),magenta:t(35,39),cyan:t(36,39),white:t(37,39),gray:t(90,39),bgBlack:t(40,49),bgRed:t(41,49),bgGreen:t(42,49),bgYellow:t(43,49),bgBlue:t(44,49),bgMagenta:t(45,49),bgCyan:t(46,49),bgWhite:t(47,49),blackBright:t(90,39),redBright:t(91,39),greenBright:t(92,39),yellowBright:t(93,39),blueBright:t(94,39),magentaBright:t(95,39),cyanBright:t(96,39),whiteBright:t(97,39),bgBlackBright:t(100,49),bgRedBright:t(101,49),bgGreenBright:t(102,49),bgYellowBright:t(103,49),bgBlueBright:t(104,49),bgMagentaBright:t(105,49),bgCyanBright:t(106,49),bgWhiteBright:t(107,49)},I=({useColor:e=L}={})=>e?m:Object.keys(m).reduce((i,r)=>({...i,[r]:String}),{}),{reset:X,bold:z,dim:J,italic:U,underline:V,inverse:K,hidden:Q,strikethrough:Z,black:A,red:D,green:ee,yellow:te,blue:ne,magenta:re,cyan:ie,white:oe,gray:se,bgBlack:ae,bgRed:ce,bgGreen:ge,bgYellow:le,bgBlue:de,bgMagenta:he,bgCyan:be,bgWhite:ue,blackBright:me,redBright:Be,greenBright:ye,yellowBright:fe,blueBright:pe,magentaBright:j,cyanBright:we,whiteBright:Ce,bgBlackBright:xe,bgRedBright:Re,bgGreenBright:Te,bgYellowBright:ke,bgBlueBright:ve,bgMagentaBright:Oe,bgCyanBright:Ee,bgWhiteBright:_e}=I(),h=`[${j("YTChatVer")}]`,N="nnryv-app";function b(e,i){const r=i??document.body;return new Promise(n=>{if(r.querySelector(e))return n(r.querySelector(e));const o=new MutationObserver(()=>{r.querySelector(e)&&(n(r.querySelector(e)),o.disconnect())});o.observe(r,{childList:!0,subtree:!0})})}const{fetch:P}=window;let u;const G=/member/i,W=/moderator/i,p=(e=[],i)=>e.length===0?!1:e.filter(({liveChatAuthorBadgeRenderer:n})=>n).map(({liveChatAuthorBadgeRenderer:n})=>n).filter(({tooltip:n})=>n).map(({tooltip:n})=>n).filter(n=>i.test(n)).length>0,q=(e=[])=>p(e,G),F=(e=[])=>p(e,W),Y=async(e,i,r)=>{const n=await b(`#${e} span#author-name:not(.ytc-marked)`);n.classList.add("ytc-marked");const o=document.createElement("a");o.href=`/channel/${i}`,o.innerText=n.textContent;const s=document.createElement("span");switch(s.appendChild(o),s.classList.add("ytc-verifier"),r){case"member":s.classList.add("member");break;case"moderator":s.classList.add("moderator");break}for(const c of n.childNodes)n.removeChild(c);n.appendChild(s)},B=async(e,i)=>{var s,c;const r=((s=e==null?void 0:e.contents)==null?void 0:s.liveChatRenderer)??((c=e==null?void 0:e.continuationContents)==null?void 0:c.liveChatContinuation);if(!r)return;const{actions:n}=r,o=(n==null?void 0:n.map(({addChatItemAction:a})=>{var l;return(l=a==null?void 0:a.item)==null?void 0:l.liveChatTextMessageRenderer}).filter(a=>a).map(a=>{const{authorName:l,authorExternalChannelId:d,id:w,authorBadges:C,authorPhoto:H}=a;return{authorName:l,authorExternalChannelId:d,id:w,authorBadges:C}}))??[];u&&i&&(console.log(`${h} Dispatching chat init event`),u.dispatchEvent(new CustomEvent("livechat",{detail:o})));for(const{id:a,authorExternalChannelId:l,authorBadges:d}of o)await Y(a,l,F(d)&&"moderator"||q(d)&&"member")};(async()=>(u=await b(`div#${N}`),console.log(`${h} Modify Init`),b("body>script:not([src])").then(async e=>{const r=e.text.replace(/^(.*?) = /,"").replace(/;*$/,""),n=JSON.parse(r);B(n,"init")}),console.log(`${h} Injecting fetch Capture`),window.fetch=async(e,i)=>{const r=await P(e,i);if(e instanceof Request&&e.method==="POST"&&e.url.startsWith("https://www.youtube.com/youtubei/v1/live_chat/get_live_chat")){const n=r.clone();setTimeout(async()=>{await B(await n.json())},0)}return r},console.log(`${h} Done injecting XHR Capture`)))();
