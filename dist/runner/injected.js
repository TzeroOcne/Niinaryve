const O={},C=Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"})),{env:l={},argv:x=[],platform:E=""}=typeof process>"u"?{}:process,M="NO_COLOR"in l||x.includes("--no-color"),_="FORCE_COLOR"in l||x.includes("--color"),S=E==="win32",$=l.TERM==="dumb",k=C&&void 0,L="CI"in l&&("GITHUB_ACTIONS"in l||"GITLAB_CI"in l||"CIRCLECI"in l),N=!M&&(_||S&&!$||k||L),T=(e,r,n,i,o=r.substring(0,e)+i,c=r.substring(e+n.length),g=c.indexOf(n))=>o+(g<0?c:T(g,c,n,i)),P=(e,r,n,i,o)=>e<0?n+r+i:n+T(e,r,i,o)+i,j=(e,r,n=e,i=e.length+1)=>o=>o||!(o===""||o===void 0)?P((""+o).indexOf(r,i),o,e,r,n):"",t=(e,r,n)=>j(`\x1B[${e}m`,`\x1B[${r}m`,n),R={reset:t(0,0),bold:t(1,22,"\x1B[22m\x1B[1m"),dim:t(2,22,"\x1B[22m\x1B[2m"),italic:t(3,23),underline:t(4,24),inverse:t(7,27),hidden:t(8,28),strikethrough:t(9,29),black:t(30,39),red:t(31,39),green:t(32,39),yellow:t(33,39),blue:t(34,39),magenta:t(35,39),cyan:t(36,39),white:t(37,39),gray:t(90,39),bgBlack:t(40,49),bgRed:t(41,49),bgGreen:t(42,49),bgYellow:t(43,49),bgBlue:t(44,49),bgMagenta:t(45,49),bgCyan:t(46,49),bgWhite:t(47,49),blackBright:t(90,39),redBright:t(91,39),greenBright:t(92,39),yellowBright:t(93,39),blueBright:t(94,39),magentaBright:t(95,39),cyanBright:t(96,39),whiteBright:t(97,39),bgBlackBright:t(100,49),bgRedBright:t(101,49),bgGreenBright:t(102,49),bgYellowBright:t(103,49),bgBlueBright:t(104,49),bgMagentaBright:t(105,49),bgCyanBright:t(106,49),bgWhiteBright:t(107,49)},G=({useColor:e=N}={})=>e?R:Object.keys(R).reduce((r,n)=>({...r,[n]:String}),{}),{reset:Z,bold:D,dim:I,italic:A,underline:ee,inverse:te,hidden:ne,strikethrough:re,black:ie,red:oe,green:se,yellow:ce,blue:ge,magenta:ae,cyan:le,white:be,gray:ue,bgBlack:he,bgRed:de,bgGreen:me,bgYellow:Be,bgBlue:fe,bgMagenta:ye,bgCyan:pe,bgWhite:we,blackBright:Re,redBright:ve,greenBright:xe,yellowBright:Te,blueBright:Oe,magentaBright:W,cyanBright:Ce,whiteBright:Ee,bgBlackBright:Me,bgRedBright:_e,bgGreenBright:Se,bgYellowBright:$e,bgBlueBright:ke,bgMagentaBright:Le,bgCyanBright:Ne,bgWhiteBright:Pe}=G(),B=`[${W("Niinaryve")}]`,q="nnryv-app";function y(e,r){const n=r??document.body;return new Promise(i=>{if(n.querySelector(e))return i(n.querySelector(e));const o=new MutationObserver(()=>{n.querySelector(e)&&(i(n.querySelector(e)),o.disconnect())});o.observe(n,{childList:!0,subtree:!0})})}const{fetch:F}=window;let p;const Y=/member/i,z=/moderator/i,H=/verified/i,w=(e=[],r)=>e.length===0?!1:e.filter(({liveChatAuthorBadgeRenderer:i})=>i).map(({liveChatAuthorBadgeRenderer:i})=>i).filter(({tooltip:i})=>i).map(({tooltip:i})=>i).filter(i=>r.test(i)).length>0,J=(e=[])=>w(e,Y),U=(e=[])=>w(e,z),V=(e=[])=>w(e,H),X=e=>{const r=[];return J(e)&&r.push("member"),U(e)&&r.push("moderator"),V(e)&&r.push("verified"),r},K=async(e,r,n,i)=>{const o=await y(`#${e.replace(/%/g,"\\%")} span#author-name:not(.nnryv-marked)`);if(!o)return;o.classList.add("nnryv-marked");const c=document.createElement("a");c.href=`/channel/${r}`,c.innerText=o.textContent;const g=document.createElement("span");g.appendChild(c),g.classList.add("nnryv-verifier");for(const b of n)g.classList.add(b);for(const b of o.childNodes)o.removeChild(b);o.appendChild(g)},Q=(e,r)=>{const{actions:n}=r;return n?e.concat(...n):e.concat(r)},v=async(e,r)=>{var g,b;const n=((g=e==null?void 0:e.contents)==null?void 0:g.liveChatRenderer)??((b=e==null?void 0:e.continuationContents)==null?void 0:b.liveChatContinuation);if(!n)return;const{actions:i}=n,c=((i??[]).map(s=>s.replayChatItemAction?s.replayChatItemAction:s).reduce(Q,[])??[]).map(({addChatItemAction:s,addLiveChatTickerItemAction:a})=>{var h,d,m,f;const u=((h=s==null?void 0:s.item)==null?void 0:h.liveChatTextMessageRenderer)??((d=s==null?void 0:s.item)==null?void 0:d.liveChatPaidMessageRenderer)??((m=a==null?void 0:a.item)==null?void 0:m.liveChatTickerSponsorItemRenderer);return u&&{renderer:u,paid:!!((f=s==null?void 0:s.item)!=null&&f.liveChatTextMessageRenderer)}}).filter(s=>s).map(({renderer:s,paid:a})=>{const{authorName:u,authorExternalChannelId:h,id:d,authorBadges:m,authorPhoto:f}=s;return{authorName:u,authorExternalChannelId:h,authorBadges:m,id:d,paid:a}});p&&r&&(console.log(`${B} Dispatching chat init event`),p.dispatchEvent(new CustomEvent("livechat",{detail:c})));for(const{id:s,authorExternalChannelId:a,authorBadges:u}of c)K(s,a,X(u))};(async()=>(p=await y(`div#${q}`),console.log(`${B} Modify Init`),y("body>script:not([src])").then(async e=>{const n=e.text.replace(/^(.*?) = /,"").replace(/;*$/,""),i=JSON.parse(n);v(i,"init")}),console.log(`${B} Injecting fetch Capture`),window.fetch=async(e,r)=>{const n=await F(e,r);if(e instanceof Request&&e.method==="POST"&&e.url.startsWith("https://www.youtube.com/youtubei/v1/live_chat/get_live_chat")){const i=n.clone();setTimeout(async()=>{await v(await i.json())},0)}return n},console.log(`${B} Done injecting fetch Capture`)))();
