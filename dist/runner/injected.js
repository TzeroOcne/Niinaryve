const T={},x=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"})),{env:g={},argv:f=[],platform:k=""}=typeof process>"u"?{}:process,v="NO_COLOR"in g||f.includes("--no-color"),O="FORCE_COLOR"in g||f.includes("--color"),E=k==="win32",_=g.TERM==="dumb",I=x&&void 0,M="CI"in g&&("GITHUB_ACTIONS"in g||"GITLAB_CI"in g||"CIRCLECI"in g),L=!v&&(O||E&&!_||I||M),p=(e,i,r,n,o=i.substring(0,e)+n,c=i.substring(e+r.length),s=c.indexOf(r))=>o+(s<0?c:p(s,c,r,n)),S=(e,i,r,n,o)=>e<0?r+i+n:r+p(e,i,n,o)+n,$=(e,i,r=e,n=e.length+1)=>o=>o||!(o===""||o===void 0)?S((""+o).indexOf(i,n),o,e,i,r):"",t=(e,i,r)=>$(`\x1B[${e}m`,`\x1B[${i}m`,r),B={reset:t(0,0),bold:t(1,22,"\x1B[22m\x1B[1m"),dim:t(2,22,"\x1B[22m\x1B[2m"),italic:t(3,23),underline:t(4,24),inverse:t(7,27),hidden:t(8,28),strikethrough:t(9,29),black:t(30,39),red:t(31,39),green:t(32,39),yellow:t(33,39),blue:t(34,39),magenta:t(35,39),cyan:t(36,39),white:t(37,39),gray:t(90,39),bgBlack:t(40,49),bgRed:t(41,49),bgGreen:t(42,49),bgYellow:t(43,49),bgBlue:t(44,49),bgMagenta:t(45,49),bgCyan:t(46,49),bgWhite:t(47,49),blackBright:t(90,39),redBright:t(91,39),greenBright:t(92,39),yellowBright:t(93,39),blueBright:t(94,39),magentaBright:t(95,39),cyanBright:t(96,39),whiteBright:t(97,39),bgBlackBright:t(100,49),bgRedBright:t(101,49),bgGreenBright:t(102,49),bgYellowBright:t(103,49),bgBlueBright:t(104,49),bgMagentaBright:t(105,49),bgCyanBright:t(106,49),bgWhiteBright:t(107,49)},N=({useColor:e=L}={})=>e?B:Object.keys(B).reduce((i,r)=>({...i,[r]:String}),{}),{reset:J,bold:U,dim:K,italic:Q,underline:V,inverse:Z,hidden:A,strikethrough:D,black:ee,red:te,green:ne,yellow:re,blue:ie,magenta:oe,cyan:ae,white:ce,gray:se,bgBlack:ge,bgRed:le,bgGreen:de,bgYellow:he,bgBlue:be,bgMagenta:me,bgCyan:ue,bgWhite:Be,blackBright:ye,redBright:fe,greenBright:pe,yellowBright:we,blueBright:Ce,magentaBright:j,cyanBright:Re,whiteBright:Te,bgBlackBright:xe,bgRedBright:ke,bgGreenBright:ve,bgYellowBright:Oe,bgBlueBright:Ee,bgMagentaBright:_e,bgCyanBright:Ie,bgWhiteBright:Me}=N(),h=`[${j("Niinaryve")}]`,P="nnryv-app";function b(e,i){const r=i??document.body;return new Promise(n=>{if(r.querySelector(e))return n(r.querySelector(e));const o=new MutationObserver(()=>{r.querySelector(e)&&(n(r.querySelector(e)),o.disconnect())});o.observe(r,{childList:!0,subtree:!0})})}const{fetch:G}=window;let m;const W=/member/i,q=/moderator/i,w=(e=[],i)=>e.length===0?!1:e.filter(({liveChatAuthorBadgeRenderer:n})=>n).map(({liveChatAuthorBadgeRenderer:n})=>n).filter(({tooltip:n})=>n).map(({tooltip:n})=>n).filter(n=>i.test(n)).length>0,F=(e=[])=>w(e,W),Y=(e=[])=>w(e,q),H=async(e,i,r)=>{const n=await b(`#${e} span#author-name:not(.ytc-marked)`);n.classList.add("ytc-marked");const o=document.createElement("a");o.href=`/channel/${i}`,o.innerText=n.textContent;const c=document.createElement("span");switch(c.appendChild(o),c.classList.add("ytc-verifier"),r){case"member":c.classList.add("member");break;case"moderator":c.classList.add("moderator");break}for(const s of n.childNodes)n.removeChild(s);n.appendChild(c)},X=(e,i)=>{const{actions:r}=i;return r?e.concat(...r):e.concat(i)},y=async(e,i)=>{var s,u;const r=((s=e==null?void 0:e.contents)==null?void 0:s.liveChatRenderer)??((u=e==null?void 0:e.continuationContents)==null?void 0:u.liveChatContinuation);if(!r)return;const{actions:n}=r,c=(n.map(a=>a.replayChatItemAction?a.replayChatItemAction:a).reduce(X,[])??[]).map(({addChatItemAction:a})=>{var l;return(l=a==null?void 0:a.item)==null?void 0:l.liveChatTextMessageRenderer}).filter(a=>a).map(a=>{const{authorName:l,authorExternalChannelId:d,id:C,authorBadges:R,authorPhoto:z}=a;return{authorName:l,authorExternalChannelId:d,id:C,authorBadges:R}});m&&i&&(console.log(`${h} Dispatching chat init event`),m.dispatchEvent(new CustomEvent("livechat",{detail:c})));for(const{id:a,authorExternalChannelId:l,authorBadges:d}of c)await H(a,l,Y(d)&&"moderator"||F(d)&&"member")};(async()=>(m=await b(`div#${P}`),console.log(`${h} Modify Init`),b("body>script:not([src])").then(async e=>{const r=e.text.replace(/^(.*?) = /,"").replace(/;*$/,""),n=JSON.parse(r);y(n,"init")}),console.log(`${h} Injecting fetch Capture`),window.fetch=async(e,i)=>{const r=await G(e,i);if(e instanceof Request&&e.method==="POST"&&e.url.startsWith("https://www.youtube.com/youtubei/v1/live_chat/get_live_chat")){const n=r.clone();setTimeout(async()=>{await y(await n.json())},0)}return r},console.log(`${h} Done injecting XHR Capture`)))();
