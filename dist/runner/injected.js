const O={},C=Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"})),{env:l={},argv:x=[],platform:E=""}=typeof process>"u"?{}:process,M="NO_COLOR"in l||x.includes("--no-color"),_="FORCE_COLOR"in l||x.includes("--color"),S=E==="win32",$=l.TERM==="dumb",k=C&&void 0,N="CI"in l&&("GITHUB_ACTIONS"in l||"GITLAB_CI"in l||"CIRCLECI"in l),L=!M&&(_||S&&!$||k||N),T=(e,r,t,i,o=r.substring(0,e)+i,c=r.substring(e+t.length),a=c.indexOf(t))=>o+(a<0?c:T(a,c,t,i)),P=(e,r,t,i,o)=>e<0?t+r+i:t+T(e,r,i,o)+i,j=(e,r,t=e,i=e.length+1)=>o=>o||!(o===""||o===void 0)?P((""+o).indexOf(r,i),o,e,r,t):"",n=(e,r,t)=>j(`\x1B[${e}m`,`\x1B[${r}m`,t),v={reset:n(0,0),bold:n(1,22,"\x1B[22m\x1B[1m"),dim:n(2,22,"\x1B[22m\x1B[2m"),italic:n(3,23),underline:n(4,24),inverse:n(7,27),hidden:n(8,28),strikethrough:n(9,29),black:n(30,39),red:n(31,39),green:n(32,39),yellow:n(33,39),blue:n(34,39),magenta:n(35,39),cyan:n(36,39),white:n(37,39),gray:n(90,39),bgBlack:n(40,49),bgRed:n(41,49),bgGreen:n(42,49),bgYellow:n(43,49),bgBlue:n(44,49),bgMagenta:n(45,49),bgCyan:n(46,49),bgWhite:n(47,49),blackBright:n(90,39),redBright:n(91,39),greenBright:n(92,39),yellowBright:n(93,39),blueBright:n(94,39),magentaBright:n(95,39),cyanBright:n(96,39),whiteBright:n(97,39),bgBlackBright:n(100,49),bgRedBright:n(101,49),bgGreenBright:n(102,49),bgYellowBright:n(103,49),bgBlueBright:n(104,49),bgMagentaBright:n(105,49),bgCyanBright:n(106,49),bgWhiteBright:n(107,49)},q=({useColor:e=L}={})=>e?v:Object.keys(v).reduce((r,t)=>({...r,[t]:String}),{}),{reset:Z,bold:I,dim:A,italic:ee,underline:ne,inverse:te,hidden:re,strikethrough:ie,black:oe,red:se,green:ce,yellow:ae,blue:ge,magenta:le,cyan:ue,white:be,gray:he,bgBlack:de,bgRed:me,bgGreen:fe,bgYellow:ye,bgBlue:Be,bgMagenta:pe,bgCyan:we,bgWhite:ve,blackBright:Re,redBright:xe,greenBright:Te,yellowBright:Oe,blueBright:Ce,magentaBright:G,cyanBright:Ee,whiteBright:Me,bgBlackBright:_e,bgRedBright:Se,bgGreenBright:$e,bgYellowBright:ke,bgBlueBright:Ne,bgMagentaBright:Le,bgCyanBright:Pe,bgWhiteBright:je}=q(),f=`[${G("Niinaryve")}]`,W="nnryv-app";function B(e,r){const t=r??document.body;return new Promise(i=>{if(t.querySelector(e))return i(t.querySelector(e));const o=new MutationObserver(()=>{t.querySelector(e)&&(i(t.querySelector(e)),o.disconnect())});o.observe(t,{childList:!0,subtree:!0})})}const{fetch:F}=window;let p;const Y=/member/i,z=/moderator/i,D=/verified/i,w=(e=[],r)=>e.length===0?!1:e.filter(({liveChatAuthorBadgeRenderer:i})=>i).map(({liveChatAuthorBadgeRenderer:i})=>i).filter(({tooltip:i})=>i).map(({tooltip:i})=>i).filter(i=>r.test(i)).length>0,H=(e=[])=>w(e,Y),J=(e=[])=>w(e,z),U=(e=[])=>w(e,D),V=e=>{const r=[];return H(e)&&r.push("member"),J(e)&&r.push("moderator"),U(e)&&r.push("verified"),r},X=async()=>{for(const e of document.querySelectorAll(".nnryv-verifier ~ .nnryv-verifier"))e.remove()},K=async(e,r,t,i)=>{const o=await B(`#${e.replace(/%/g,"\\%")} span#author-name:not(.nnryv-marked)`);if(!o)return;o.classList.add("nnryv-marked");const c=document.createElement("a");c.href=`/channel/${r}`,c.innerText=o.textContent;const a=document.createElement("span");a.appendChild(c),a.classList.add("nnryv-verifier");for(const u of t)a.classList.add(u);for(const u of o.childNodes)o.removeChild(u);o.appendChild(a),setTimeout(X,0)},Q=(e,r)=>{const{actions:t}=r;return t?e.concat(...t):e.concat(r)},R=async(e,r)=>{var a,u;const t=((a=e==null?void 0:e.contents)==null?void 0:a.liveChatRenderer)??((u=e==null?void 0:e.continuationContents)==null?void 0:u.liveChatContinuation);if(!t)return;const{actions:i}=t,c=((i??[]).map(s=>s.replayChatItemAction?s.replayChatItemAction:s).reduce(Q,[])??[]).map(({addChatItemAction:s,addLiveChatTickerItemAction:g})=>{var h,d,m,y;const b=((h=s==null?void 0:s.item)==null?void 0:h.liveChatTextMessageRenderer)??((d=s==null?void 0:s.item)==null?void 0:d.liveChatPaidMessageRenderer)??((m=g==null?void 0:g.item)==null?void 0:m.liveChatTickerSponsorItemRenderer);return b&&{renderer:b,paid:!!((y=s==null?void 0:s.item)!=null&&y.liveChatTextMessageRenderer)}}).filter(s=>s).map(({renderer:s,paid:g})=>{const{authorName:b,authorExternalChannelId:h,id:d,authorBadges:m,authorPhoto:y}=s;return{authorName:b,authorExternalChannelId:h,authorBadges:m,id:d,paid:g}});p&&r&&(console.log(`${f} Dispatching chat init event`),p.dispatchEvent(new CustomEvent("livechat",{detail:c})));for(const{id:s,authorExternalChannelId:g,authorBadges:b}of c)K(s,g,V(b))};(async()=>(p=await B(`div#${W}`),console.log(`${f} Modify Init`),B("body>script:not([src])").then(async e=>{const t=e.text.replace(/^(.*?) = /,"").replace(/;*$/,""),i=JSON.parse(t);R(i,"init")}),console.log(`${f} Injecting fetch Capture`),window.fetch=async(e,r)=>{const t=await F(e,r);if(e instanceof Request&&e.method==="POST"&&e.url.startsWith("https://www.youtube.com/youtubei/v1/live_chat/get_live_chat")){const i=t.clone();setTimeout(async()=>{await R(await i.json())},0)}return t},console.log(`${f} Done injecting fetch Capture`)))();
