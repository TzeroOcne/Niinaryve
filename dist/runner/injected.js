const _={},S=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"})),{env:a={},argv:x=[],platform:$=""}=typeof process>"u"?{}:process,k="NO_COLOR"in a||x.includes("--no-color"),L="FORCE_COLOR"in a||x.includes("--color"),N=$==="win32",j=a.TERM==="dumb",q=S&&void 0,G="CI"in a&&("GITHUB_ACTIONS"in a||"GITLAB_CI"in a||"CIRCLECI"in a),W=!k&&(L||N&&!j||q||G),C=(e,t,r,i,o=t.substring(0,e)+i,c=t.substring(e+r.length),l=c.indexOf(r))=>o+(l<0?c:C(l,c,r,i)),F=(e,t,r,i,o)=>e<0?r+t+i:r+C(e,t,i,o)+i,Y=(e,t,r=e,i=e.length+1)=>o=>o||!(o===""||o===void 0)?F((""+o).indexOf(t,i),o,e,t,r):"",n=(e,t,r)=>Y(`\x1B[${e}m`,`\x1B[${t}m`,r),R={reset:n(0,0),bold:n(1,22,"\x1B[22m\x1B[1m"),dim:n(2,22,"\x1B[22m\x1B[2m"),italic:n(3,23),underline:n(4,24),inverse:n(7,27),hidden:n(8,28),strikethrough:n(9,29),black:n(30,39),red:n(31,39),green:n(32,39),yellow:n(33,39),blue:n(34,39),magenta:n(35,39),cyan:n(36,39),white:n(37,39),gray:n(90,39),bgBlack:n(40,49),bgRed:n(41,49),bgGreen:n(42,49),bgYellow:n(43,49),bgBlue:n(44,49),bgMagenta:n(45,49),bgCyan:n(46,49),bgWhite:n(47,49),blackBright:n(90,39),redBright:n(91,39),greenBright:n(92,39),yellowBright:n(93,39),blueBright:n(94,39),magentaBright:n(95,39),cyanBright:n(96,39),whiteBright:n(97,39),bgBlackBright:n(100,49),bgRedBright:n(101,49),bgGreenBright:n(102,49),bgYellowBright:n(103,49),bgBlueBright:n(104,49),bgMagentaBright:n(105,49),bgCyanBright:n(106,49),bgWhiteBright:n(107,49)},P=({useColor:e=W}={})=>e?R:Object.keys(R).reduce((t,r)=>({...t,[r]:String}),{}),{reset:re,bold:ie,dim:oe,italic:se,underline:ce,inverse:le,hidden:ge,strikethrough:ae,black:ue,red:be,green:de,yellow:he,blue:me,magenta:fe,cyan:Be,white:ye,gray:pe,bgBlack:we,bgRed:ve,bgGreen:Re,bgYellow:Te,bgBlue:xe,bgMagenta:Ce,bgCyan:Oe,bgWhite:Ee,blackBright:Me,redBright:_e,greenBright:Se,yellowBright:$e,blueBright:ke,magentaBright:z,cyanBright:Le,whiteBright:Ne,bgBlackBright:je,bgRedBright:qe,bgGreenBright:Ge,bgYellowBright:We,bgBlueBright:Fe,bgMagentaBright:Ye,bgCyanBright:Pe,bgWhiteBright:ze}=P(),B=`[${z("Niinaryve")}]`,D="nnryv-app";function p(e,t){const r=t??document.body;return new Promise(i=>{if(r.querySelector(e))return i(r.querySelector(e));const o=new MutationObserver(()=>{r.querySelector(e)&&(i(r.querySelector(e)),o.disconnect())});o.observe(r,{childList:!0,subtree:!0})})}const{fetch:H}=window;let w;const J=/member/i,U=/moderator/i,V=/verified/i,v=(e=[],t)=>e.length===0?!1:e.filter(({liveChatAuthorBadgeRenderer:i})=>i).map(({liveChatAuthorBadgeRenderer:i})=>i).filter(({tooltip:i})=>i).map(({tooltip:i})=>i).filter(i=>t.test(i)).length>0,X=(e=[])=>v(e,J),I=(e=[])=>v(e,U),K=(e=[])=>v(e,V),Q=e=>{const t=[];return X(e)&&t.push("member"),I(e)&&t.push("moderator"),K(e)&&t.push("verified"),t},Z=async()=>{for(const e of document.querySelectorAll(".nnryv-verifier ~ .nnryv-verifier"))e.remove()},A=async(e,t,r,i)=>{const o=await p(`[id="${e}"] span#author-name:not(.nnryv-marked)`);if(!o)return;o.classList.add("nnryv-marked");const c=document.createElement("a");c.href=`/channel/${t}`,c.innerText=o.textContent;const l=document.createElement("span");l.appendChild(c),l.classList.add("nnryv-verifier");for(const u of r)l.classList.add(u);for(const u of o.childNodes)o.removeChild(u);o.appendChild(l),setTimeout(Z,0)},ee=(e,t)=>{const{actions:r}=t;return r?e.concat(...r):e.concat(t)},y=(e=[])=>{if(e.length===0)return;let t=e[0];for(const r of e.slice(1))r.height>t.height&&(t=r);return t},te=e=>{let t;if(e instanceof Array){const r=e.map(({thumbnails:i})=>y(i)).filter(i=>i);t=y(r)}else t=y(e==null?void 0:e.thumbnails);return t==null?void 0:t.url},ne=(e=[])=>{var r;if(e.length===0)return;const t=e.filter(i=>{var o,c;return(c=(o=i==null?void 0:i.liveChatAuthorBadgeRenderer)==null?void 0:o.customThumbnail)==null?void 0:c.thumbnails}).map(i=>i.liveChatAuthorBadgeRenderer.customThumbnail.thumbnails).reduce((i,o)=>[...i,...o],[]);return(r=y(t))==null?void 0:r.url},T=async(e,t)=>{var l,u;const r=((l=e==null?void 0:e.contents)==null?void 0:l.liveChatRenderer)??((u=e==null?void 0:e.continuationContents)==null?void 0:u.liveChatContinuation);if(!r)return;const{actions:i}=r,c=((i??[]).map(s=>s.replayChatItemAction?s.replayChatItemAction:s).reduce(ee,[])??[]).map(({addChatItemAction:s,addLiveChatTickerItemAction:g})=>{var h,m,d,f;const b=((h=s==null?void 0:s.item)==null?void 0:h.liveChatTextMessageRenderer)??((m=s==null?void 0:s.item)==null?void 0:m.liveChatPaidMessageRenderer)??((d=g==null?void 0:g.item)==null?void 0:d.liveChatTickerSponsorItemRenderer);return b&&{renderer:b,paid:!!((f=s==null?void 0:s.item)!=null&&f.liveChatTextMessageRenderer)}}).filter(s=>s).map(({renderer:s,paid:g})=>{const{authorName:b,authorExternalChannelId:h,id:m,authorBadges:d,authorPhoto:f}=s,O=te(f),E=ne(d),M=Q(d);return{authorName:b,authorExternalChannelId:h,authorBadges:d,id:m,paid:g,photo:O,badgeList:M,badgeImg:E}});w&&(t&&console.log(`${B} Dispatching chat init event`),w.dispatchEvent(new CustomEvent("livechat",{detail:c})));for(const{id:s,authorExternalChannelId:g,badgeList:b}of c)A(s,g,b)};(async()=>(w=await p(`div#${D}`),console.log(`${B} Modify Init`),p("body>script:not([src])").then(async e=>{const r=e.text.replace(/^(.*?) = /,"").replace(/;*$/,""),i=JSON.parse(r);T(i,"init")}),console.log(`${B} Injecting fetch Capture`),window.fetch=async(e,t)=>{const r=await H(e,t);if(e instanceof Request&&e.method==="POST"&&e.url.startsWith("https://www.youtube.com/youtubei/v1/live_chat/get_live_chat")){const i=r.clone();setTimeout(async()=>{await T(await i.json())},0)}return r},console.log(`${B} Done injecting fetch Capture`)))();
